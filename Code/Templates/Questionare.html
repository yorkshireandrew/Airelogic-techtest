<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <title>Health Test Questionnaire</title>
  </head>
  <body>
    <h1>Health Test Questionnaire</h1>
    
    <form id="health-form" method="post" action="/questionare-submit">
      <table>
          <thead>
              <tr>
                  <th>Question</th>
                  <th>Yes</th>
                  <th>No</th>
              </tr>
          </thead>
          <tbody>
              {{Questions}}
          </tbody>
      </table>

      <input type="hidden" name="AgeBand" value="{{AgeBand}}" />
      <input type="hidden" name="TotalQuestions" value="{{TotalQuestions}}" />
      <button id="health-submit" type="submit" disabled>Submit</button>
    </form>

    <script>
      totalQuestions = {{TotalQuestions}};
      // Holds the names of the selected radio buttons, e.g. 'Y0','N0','Y1'
      window.selectedAnswers = window.selectedAnswers || new Set();

      function onAnswerChange(el) {
        try {
          if (!el || !el.name) return;
          var name = el.name;
          var prefix = name.charAt(0);
          var number = name.substring(1);
          var otherName = (prefix === 'Y' ? 'N' : 'Y') + number;

          // Uncheck the opposite input(s)
          var others = document.getElementsByName(otherName);
          for (var i = 0; i < others.length; i++) {
            others[i].checked = false;
          }

            // Update the set of selected answers (store the selected input name)
          if (el.checked) {
            window.selectedAnswers.add(name);
            window.selectedAnswers.delete(otherName);
          } else {
            window.selectedAnswers.delete(name);
          }
            // Update submit button state
            updateSubmitState();
        } catch (e) {}
      }

      function updateSubmitState() {
        try {
          var submit = document.getElementById('health-submit');
          if (!submit) return;
          submit.disabled = (window.selectedAnswers.size !== Number(totalQuestions));
        } catch (e) {
          // ignore
        }
      }

      // Clear all radio selections on initial load and reset tracking set
      document.addEventListener('DOMContentLoaded', function () {
        try {
          var radios = document.querySelectorAll('input[type="radio"]');
          radios.forEach(function(r) { r.checked = false; });
          window.selectedAnswers = new Set();
            // ensure submit is disabled initially
            var submit = document.getElementById('health-submit');
            if (submit) submit.disabled = true;
        } catch (e) {
          // ignore
        }
      });
    </script>
  </body>
</html>